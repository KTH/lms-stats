<html>

<head>

<script src="chartist.js"></script>
<script src="moment.js"></script>
<script src="chartist-plugin-barlabels.js"></script>
<script src="d3.js"></script>
<script src="c3.js"></script>

<link rel="stylesheet" type="text/css" href="c3.css">
<link rel="stylesheet" type="text/css" href="chartist.css">
<link rel="stylesheet" type="text/css" href="basic.css">

</head>

<body>

<div id="load">

<center><br><br><h2>Fetching data from KTH Canvas LMS</h2>This page is based on realtime data from the Canvas API.<br>It can take up to about 30 seconds for all graphs to be rendered.</center>
<div id="loader"></div></div>

<div id="content">
<h1>KTH Canvas LMS</h1>
Data from KTH Canvas LMS (https://kth.instructure.com). All graphs display realtime data unless otherwise stated.
<br><br>
<h2>Table of contents</h2>
1. Statistics<br>
&nbsp;&nbsp;<a href="#11">1.1. Daily Statistics</a><br>
&nbsp;&nbsp;<a href="#12">1.2. Page views per content category</a><br>
2. Course publishing<br>
&nbsp;&nbsp;<a href="#21">2.1. Ladok course publishing over time</a><br>
&nbsp;&nbsp;<a href="#22">2.2. Ladok Course publishing percentage for the academic year 2017/2018</a><br>
&nbsp;&nbsp;<a href="courses.html#23">2.3. Course publishing on school level</a><br>
&nbsp;&nbsp;<a href="public.html#24">2.4. List of open courses published</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;2.4.1. Courses published publicly<br>
&nbsp;&nbsp;&nbsp;&nbsp;2.4.2. Courses published to all at KTH<br>
&nbsp;&nbsp;<a href="courses.html#25">2.5. Course publishing on school level</a><br>
&nbsp;&nbsp;<a href="courses.html#26">2.6. Ladok courses publish status</a><br>
&nbsp;&nbsp;<a href="courses.html#27">2.7 Currently published Ladok-courses/school</a><br>
3. Usage<br>
&nbsp;&nbsp;<a href="#31">3.1 Aggregated usage</a><br>
&nbsp;&nbsp;<a href="usage.html#32">3.2. Uploaded files/school</a><br>
&nbsp;&nbsp;<a href="usage.html#33">3.3. Student assignement submissions/school</a><br>
&nbsp;&nbsp;<a href="usage.html#34">3.4. Discussion posts/school</a><br>
&nbsp;&nbsp;<a href="usage.html#35">3.5. Video/Audio objects/school</a><br>
4. User activity<br>
&nbsp;&nbsp;<a href="#41">4.1. Active teachers/school</a><br>
&nbsp;&nbsp;<a href="#42">4.2. Active students/school</a><br>

<br><hr><br>

<h1>1. Statistics</h1>
<h2 id="11">1.1. Daily Statistics</h2>
<br>
<br>
<div id="chart"></div>
<h3>Instructions</h3>
<ol>
  <li>Hover pointer for current data for any particular date.</li>
  <li>Zoom in/out by placing the pointer and use mousewheel/touchpad to zoom in on that area. You can also scroll left/right when you have zoomed in.</li>
  <li>Toggle which data to highlight/show by hovering/clicking on the legend.</li>
</ol>

<br><hr><br>

<h2 id="12">1.2. Page views per content category</h2>
Total number of pageviews grouped by category for the KTH Canvas instance gathered from 2016-05-10 when the system was deployed.
<br>
<div class="ct-chart5 ct-minor-seventh"></div>
<br><hr><br>

<h1>2. Course publishing</h1>
<h2 id="21">2.1. Ladok course publishing over time</h2>
All courses imported from Ladok with <em>at least one</em> person enrolled (teacher and/or student) and their publishing state in Canvas. The data grouped for each study period (P1-4) during the academic year. The bars represent the sum of all five schools at KTH.
<br><br>
<div id="chart2"></div>
<br><br>
<table id="legend" width="100%">
  <tr>
    <td width="33%">Courses</td>
    <td width="34%">Published</td>
    <td width="33%">Open</td>
  </tr>
  <tr>
    <td>Shows all courses currently imported with <em>at least one</em> user enrolled. For future courses the bar is likely to grow as more courses are added in KOPPS.</td>
    <td>Ladok courses current published for the particular study period regardless of access restriction (closed, institution, public).</td>
    <td>All published Ladok courses that are published either as <em>open to all users at KTH</em> or <em>Public</em> and thus not requiring a KTH-account to access them.</td>
  </tr>
</table>
<br>
<br><hr><br>

<h2 id="22">2.2. Ladok Course publishing percentage for the academic year 2017/2018</h2>
<br>
<table Width="100%">
  <tr>
    <td width="10%"></td>
    <td width="18%">P1 2017/2018</td>
    <td width="18%">P2 2017/2018</td>
    <td width="18%">P3 2017/2018</td>
    <td width="18%">P4 2017/2018</td>
    <td width="18%">2017/2018</td>
</tr>
<tr>
  <td width="10%">KTH</td>
  <td width="18%"><div id="KTH_ladok_courses_P1_20172018"></div></td>
  <td width="18%"><div id="KTH_ladok_courses_P2_20172018"></div></td>
  <td width="18%"><div id="KTH_ladok_courses_P3_20172018"></div></td>
  <td width="18%"><div id="KTH_ladok_courses_P4_20172018"></div></td>
  <td width="18%"><div id="KTH_ladok_courses_20172018"></div></td>
</tr>
</table>
<br>
<br><hr><br>

<h2>2.3. Course publishing on school level</h2>
<a href="courses.html#23">Click to load subpage</a>.
<h2>2.4. List of open courses published</h2>
<a href="public.html">Click to load subpage</a>.
<h2>2.5. Course publishing on school level</h2>
<a href="courses.html#25">Click to load subpage</a>.
<h2>2.6. Ladok courses publish status</h2>
<a href="courses.html#26">Click to load subpagee</a>.
<h2>2.7 Currently published Ladok-courses/school</h2>
<a href="courses.html#27">Click to load subpage</a>.
<br>
<br><hr><br>

<h1>3. Usage</h1>
<h2 id="31">3.1. Aggregated usage</h2>
Aggregated statistics for the KTH Canvas instance gathered from 2016-05-10 when the system was first deployed.
<br>
<div class="ct-chart1 ct-minor-seventh"></div>

<br>
<br><hr><br>

<h2>3.2. Uploaded files/school</h2>
<a href="usage.html#32">Click to load subpage</a>.
<h2>3.3. Student assignement submissions/school</h2>
<a href="usage.html#33">Click to load subpage</a>.
<h2>3.4. Discussion posts/school</h2>
<a href="usage.html#34">Click to load subpage</a>.
<h2>3.5. Video/Audio objects/school</h2>
<a href="usage.html#35">Click to load subpagee</a>.
<br>
<br><hr><br>

<br>
<br><hr><br>

<h1>4. User activity</h1>
<h2 id="41">4.1. Active teachers/school</h2>
Number of users with a teacher role (Teacher, Course responsible, Examinator or TA). Please note that one user can be listed as "teacher" on more than one of the school due to roles being set for each course.
<br>
<div class="ct-chart3 ct-minor-seventh"></div>
<br><hr><br>

<h2 id="42">4.2. Active students/school</h2>
Number of users with a student role (Admitted and/or Registrered) that has logged into the system. Please note that one user can be listed as "student" on more than one of the school due to roles being set on each course.
<br><br>
<div class="ct-chart4 ct-minor-seventh"></div>
<br><hr><br>

<center>KTH LMS Stats version 3.5.1 (2018-05-12) - <a href="mailto:jfridell@kth.se">jfridell@kth.se</a><br>
Source code: <a href="https://github.com/KTH/lms-stats">https://github.com/KTH/lms-stats</a></center>

</div>

<script>

    async function drawGraph(){

// Fetch global course data for all courses. This data is refreshed only on app restart.

    const responseKTHCOURSES = await fetch('/api/lms-stats/kthcourses')
    const myJsonKTHCOURSES = await responseKTHCOURSES.json()

// Fetch global course data for all courses with active enrollments. This data is refreshed only on app restart.

    const responseKTHENRCOURSES = await fetch('/api/lms-stats/kthenrcourses')
    const myJsonKTHENRCOURSES = await responseKTHENRCOURSES.json()

// fetch global analytics data

    const responseKTHA = await fetch('/api/lms-stats/ktha')
    const myJsonKTHA = await responseKTHA.json()

// Map data for each category

    const dates = myJsonKTHA[0].by_date.map(o => o.date)
    const views = myJsonKTHA[0].by_date.map(o => o.views)
    const participations = myJsonKTHA[0].by_date.map(o => o.participations)

    var arr = [myJsonKTHA[0].by_date];
    var maxviews = Math.max(...views);

    var arr = [myJsonKTHA[0].by_date];
    var maxparticipations = Math.max(...participations);

// Generate C3JS graph daily usage

// Create constants for use in graphs making the code slightly easier to read.

// ABE school (simple 1-1 account mapping)

// Courses are mapped to each studyperiod based on start-date.

// P1 XXXX-08-01 - XXXX-09-30
// P2 XXXX-10-01 - XXXX-12-31
// P3 XXXY-01-01 - XXXY-02-28
// P3 XXXY-03-01 - XXXY-05-31

const KTH_ladok_courses_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).length

const KTH_ladok_courses_20162017_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2016-08-01', '2017-06-01')  ).length
const KTH_ladok_courses_20172018_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-08-01', '2018-06-01')  ).length
const KTH_ladok_courses_20182019_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-08-01', '2019-06-01')  ).length

const KTH_ladok_courses_20162017_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2016-08-01', '2017-06-01')  ).length
const KTH_ladok_courses_20172018_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-08-01', '2018-06-01')  ).length
const KTH_ladok_courses_20182019_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-08-01', '2019-06-01')  ).length

const KTH_ladok_courses_20162017_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2016-08-01', '2017-06-01')  ).length
const KTH_ladok_courses_20172018_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-08-01', '2018-06-01')  ).length
const KTH_ladok_courses_20182019_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-08-01', '2019-06-01')  ).length

const KTH_ladok_courses_P1_20162017_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2016-08-01', '2016-10-01')  ).length
const KTH_ladok_courses_P1_20172018_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-08-01', '2017-10-01')  ).length
const KTH_ladok_courses_P1_20182019_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-08-01', '2018-10-01')  ).length

const KTH_ladok_courses_P1_20162017_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2016-08-01', '2016-10-01')  ).length
const KTH_ladok_courses_P1_20172018_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-08-01', '2017-10-01')  ).length
const KTH_ladok_courses_P1_20182019_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-08-01', '2018-10-01')  ).length

const KTH_ladok_courses_P1_20162017_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2016-08-01', '2016-10-01')  ).length
const KTH_ladok_courses_P1_20172018_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-08-01', '2017-10-01')  ).length
const KTH_ladok_courses_P1_20182019_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-08-01', '2018-10-01')  ).length

const KTH_ladok_courses_P2_20162017_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2016-10-02', '2016-12-31')  ).length
const KTH_ladok_courses_P2_20172018_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-10-02', '2017-12-31')  ).length
const KTH_ladok_courses_P2_20182019_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-10-02', '2018-12-31')  ).length

const KTH_ladok_courses_P2_20162017_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2016-10-02', '2016-12-31')  ).length
const KTH_ladok_courses_P2_20172018_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-10-02', '2017-12-31')  ).length
const KTH_ladok_courses_P2_20182019_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-10-02', '2018-12-31')  ).length

const KTH_ladok_courses_P2_20162017_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2016-10-02', '2016-12-31')  ).length
const KTH_ladok_courses_P2_20172018_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-10-02', '2017-12-31')  ).length
const KTH_ladok_courses_P2_20182019_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-10-02', '2018-12-31')  ).length

const KTH_ladok_courses_P3_20162017_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-01-01', '2017-03-01')  ).length
const KTH_ladok_courses_P3_20172018_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-01-01', '2018-03-01')  ).length
const KTH_ladok_courses_P3_20182019_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2019-01-01', '2019-03-01')  ).length

const KTH_ladok_courses_P3_20162017_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-01-01', '2017-03-01')  ).length
const KTH_ladok_courses_P3_20172018_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-01-01', '2018-03-01')  ).length
const KTH_ladok_courses_P3_20182019_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2019-01-01', '2019-03-01')  ).length

const KTH_ladok_courses_P3_20162017_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-01-01', '2017-03-01')  ).length
const KTH_ladok_courses_P3_20172018_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-01-01', '2018-03-01')  ).length
const KTH_ladok_courses_P3_20182019_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2019-01-01', '2019-03-01')  ).length

const KTH_ladok_courses_P4_20162017_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-03-02', '2017-06-01')  ).length
const KTH_ladok_courses_P4_20172018_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-03-02', '2018-06-01')  ).length
const KTH_ladok_courses_P4_20182019_enr = myJsonKTHENRCOURSES.filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2019-03-02', '2019-06-01')  ).length

const KTH_ladok_courses_P4_20162017_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-03-02', '2017-06-01')  ).length
const KTH_ladok_courses_P4_20172018_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-03-02', '2018-06-01')  ).length
const KTH_ladok_courses_P4_20182019_publ = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2019-03-02', '2019-06-01')  ).length

const KTH_ladok_courses_P4_20162017_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-03-02', '2017-06-01')  ).length
const KTH_ladok_courses_P4_20172018_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-03-02', '2018-06-01')  ).length
const KTH_ladok_courses_P4_20182019_OPEN = myJsonKTHENRCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public === true|| k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2019-03-02', '2019-06-01')  ).length

var chart = c3.generate({
          bindto: '#chart2',
    data: {
        columns: [
          ['KTH courses', KTH_ladok_courses_P1_20162017_enr, KTH_ladok_courses_P2_20162017_enr, KTH_ladok_courses_P3_20162017_enr, KTH_ladok_courses_P4_20162017_enr, KTH_ladok_courses_P1_20172018_enr, KTH_ladok_courses_P2_20172018_enr, KTH_ladok_courses_P3_20172018_enr, KTH_ladok_courses_P4_20172018_enr, KTH_ladok_courses_P1_20182019_enr, KTH_ladok_courses_P2_20182019_enr, KTH_ladok_courses_P3_20182019_enr, KTH_ladok_courses_P4_20182019_enr],

          ['KTH published', KTH_ladok_courses_P1_20162017_publ, KTH_ladok_courses_P2_20162017_publ, KTH_ladok_courses_P3_20162017_publ, KTH_ladok_courses_P4_20162017_publ, KTH_ladok_courses_P1_20172018_publ, KTH_ladok_courses_P2_20172018_publ, KTH_ladok_courses_P3_20172018_publ, KTH_ladok_courses_P4_20172018_publ, KTH_ladok_courses_P1_20182019_publ, KTH_ladok_courses_P2_20182019_publ, KTH_ladok_courses_P3_20182019_publ, KTH_ladok_courses_P4_20182019_publ],

          ['KTH open', KTH_ladok_courses_P1_20162017_OPEN, KTH_ladok_courses_P2_20162017_OPEN, KTH_ladok_courses_P3_20162017_OPEN, KTH_ladok_courses_P4_20162017_OPEN, KTH_ladok_courses_P1_20172018_OPEN, KTH_ladok_courses_P2_20172018_OPEN, KTH_ladok_courses_P3_20172018_OPEN, KTH_ladok_courses_P4_20172018_OPEN, KTH_ladok_courses_P1_20182019_OPEN, KTH_ladok_courses_P2_20182019_OPEN, KTH_ladok_courses_P3_20182019_OPEN, KTH_ladok_courses_P4_20182019_OPEN]
                      ],
        type: 'bar',
        colors: {
          'KTH courses': '#1954a6',
          'KTH published': '#1954a6',
          'KTH open': '#1954a6',
        },
        groups: [
            ['KTH courses'],
            ['KTH published'],
            ['KTH open'],
        ],
        order: null,
    },
                axis: {
        x: {
            type: 'category',
            categories: ['P1 2016/2017 ', 'P2 2016/2017', 'P3 2016/2017', 'P4 2016/2017','P1 2017/2018', 'P2 2017/2018', 'P3 2017/2018', 'P4 2017/2018','P1 2018/2019', 'P2 2018/2019', 'P3 2018/2019', 'P4 2018/2019']
        }
    },
    grid: {
        y: {
            show: true
        }
    },
});

// fetch global statistics data

  const responseKTHS = await fetch('/api/lms-stats/kths')
  const myJsonKTHS = await responseKTHS.json()

//draw graph for global statistics data

  new Chartist.Bar('.ct-chart1', {
    labels: ['Published courses total','Published Ladok courses','Active Teachers','Active Students','Discussion Posts','Video/audio recordings','Uploaded files','Student submissions'],
    series: [myJsonKTHS[0].courses, KTH_ladok_courses_publ, myJsonKTHS[0].teachers,myJsonKTHS[0].students,myJsonKTHS[0].discussion_topics,myJsonKTHS[0].media_objects,myJsonKTHS[0].attachments,myJsonKTHS[0].assignments]
  },
  {
    distributeSeries: true,
      chartPadding: {
        right: 40,
        left: 40,
        top: 40,
        bottom: 40
      },
      axisY: {
        labelInterpolationFnc: function(value) {
          return (value / 1000) + 'k';
      }
  },
      plugins: [
        Chartist.plugins.ctBarLabels(
          {
            labelOffset: {
              y: -5
            },
          })
        ],
  });

// draw graph for global statistics data

  new Chartist.Bar('.ct-chart5', {
    labels: ['Announcements','Assignments','Discussions','Files','Grades','Groups','Modules','Pages','Quizzes'],
    series: [myJsonKTHA[0].by_category[0].views, myJsonKTHA[0].by_category[1].views, myJsonKTHA[0].by_category[4].views, myJsonKTHA[0].by_category[5].views, myJsonKTHA[0].by_category[7].views, myJsonKTHA[0].by_category[8].views, myJsonKTHA[0].by_category[9].views, myJsonKTHA[0].by_category[11].views, myJsonKTHA[0].by_category[12].views]
  },
  {
    distributeSeries: true,
    chartPadding: {
      right: 40,
      left: 40,
      top: 40,
      bottom: 40
    },

    plugins: [
      Chartist.plugins.ctBarLabels(
        {
          labelOffset: {
            y: -5
          },
        })
      ],

      axisY: {
        labelInterpolationFnc: function(value) {
          return (value / 1000000) + 'M';
        }
      }
  });

// fetch school level statistics data

  const responseABES = await fetch('/api/lms-stats/abes')
  const myJsonABES = await responseABES.json()
  const responseBIOS = await fetch('/api/lms-stats/bios')
  const myJsonBIOS = await responseBIOS.json()
  const responseCHES = await fetch('/api/lms-stats/ches')
  const myJsonCHES = await responseCHES.json()
  const responseCSCS = await fetch('/api/lms-stats/cscs')
  const myJsonCSCS = await responseCSCS.json()
  const responseECES = await fetch('/api/lms-stats/eces')
  const myJsonECES = await responseECES.json()
  const responseEESS = await fetch('/api/lms-stats/eess')
  const myJsonEESS = await responseEESS.json()
  const responseICTS = await fetch('/api/lms-stats/icts')
  const myJsonICTS = await responseICTS.json()
  const responseITMS = await fetch('/api/lms-stats/itms')
  const myJsonITMS = await responseITMS.json()
  const responseSCIS = await fetch('/api/lms-stats/scis')
  const myJsonSCIS = await responseSCIS.json()
  const responseSTHS = await fetch('/api/lms-stats/sths')
  const myJsonSTHS = await responseSTHS.json()
  const responseUF = await fetch('/api/lms-stats/ufs')
  const myJsonUF = await responseUF.json()

// draw graphs for teacher role school level statistics data

  new Chartist.Bar('.ct-chart3', {
    labels: ['ABE', 'EECS (CSC+EES+ICT)', 'ITM (ITM+ECE)', 'CBH (CHE+BIO+STH)','SCI','UF'],
    series: [
      [myJsonABES[0].teachers, myJsonCSCS[0].teachers, myJsonITMS[0].teachers, myJsonCHES[0].teachers, myJsonSCIS[0].teachers, myJsonUF[0].teachers],
      [0, myJsonEESS[0].teachers, myJsonECES[0].teachers, myJsonBIOS[0].teachers, 0, 0],
      [0, myJsonICTS[0].teachers, 0, myJsonSTHS[0].teachers, 0, 0]
    ]
  },
  {
    stackBars: true,
      showLabel: true,
      chartPadding: {
        right: 40,
        left: 40,
        top: 40,
        bottom: 40
      },
      plugins: [
        Chartist.plugins.ctBarLabels(
          {
            labelOffset: {
              y: 17
            },
            labelClass: 'ct-label-white',
          })
        ],
      });

    new Chartist.Bar('.ct-chart4', {
      labels: ['ABE', 'EECS (CSC+EES+ICT)', 'ITM (ITM+ECE)', 'CBH (CHE+BIO+STH)','SCI', 'UF'],
      series: [
        [myJsonABES[0].students, myJsonCSCS[0].students, myJsonITMS[0].students, myJsonCHES[0].students, myJsonSCIS[0].students, myJsonUF[0].students],
        [0, myJsonEESS[0].students, myJsonECES[0].students, myJsonBIOS[0].students, 0, 0],
        [0, myJsonICTS[0].students, 0, myJsonSTHS[0].students, 0, 0]
        ]
    },
    {
      stackBars: true,
        showLabel: true,
        chartPadding: {
          right: 40,
          left: 40,
          top: 40,
          bottom: 40
        },
        plugins: [
          Chartist.plugins.ctBarLabels(
            {
              labelOffset: {
                y: 17
              },
              labelClass: 'ct-label-white',
            })
          ],
        });

// Bars for Ladok courses

    var chart = c3.generate({
        bindto: '#KTH_ladok_courses_P1_20172018',
      data: {
          columns: [
              ['KTH P1 2017/2018', (KTH_ladok_courses_P1_20172018_publ/KTH_ladok_courses_P1_20172018_enr)*100]
          ],
          type: 'gauge',
      },
      gauge: {
        label: {
              value: function (value, ratio, id) {
                  return value + ' (' + d3.format('%')(ratio) + ')';
         },
          show: false
      },

          units: ' %',
          width: 10, // for adjusting arc thickness
      },
      color: {
        pattern: ['#c10707', '#ff7200', '#F6C600', '#78ce5a', '#299304'],
        threshold: {
        values: [30, 50, 60, 70, 80]
        }
      },
      legend: {
        show: false
      },
      size: {
          height: 100
      },
  });

  var chart = c3.generate({
      bindto: '#KTH_ladok_courses_P2_20172018',
    data: {
        columns: [
            ['KTH P2 2017/2018', (KTH_ladok_courses_P2_20172018_publ/KTH_ladok_courses_P2_20172018_enr)*100]
        ],
        type: 'gauge',
    },
    gauge: {
      label: {
            value: function (value, ratio, id) {
                return value + ' (' + d3.format('%')(ratio) + ')';
       },
        show: false
    },
        units: ' %',
        width: 10, // for adjusting arc thickness
    },
    color: {
      pattern: ['#c10707', '#ff7200', '#F6C600', '#78ce5a', '#299304'],
      threshold: {
        values: [30, 50, 60, 70, 80]
      }
    },
    legend: {
      show: false
    },
    size: {
        height: 100
    },
});

var chart = c3.generate({
    bindto: '#KTH_ladok_courses_P3_20172018',
  data: {
      columns: [
          ['KTH P3 2017/2018', (KTH_ladok_courses_P3_20172018_publ/KTH_ladok_courses_P3_20172018_enr)*100]
      ],
      type: 'gauge',
  },
  gauge: {
    label: {
          value: function (value, ratio, id) {
              return value + ' (' + d3.format('%')(ratio) + ')';
     },
      show: false
  },

      units: ' %',
      width: 10, // for adjusting arc thickness
  },
  color: {
    pattern: ['#c10707', '#ff7200', '#F6C600', '#78ce5a', '#299304'],
    threshold: {
        values: [30, 50, 60, 70, 80]
    }
  },
  legend: {
    show: false
  },
  size: {
      height: 100
  },
});

var chart = c3.generate({
    bindto: '#KTH_ladok_courses_P4_20172018',
  data: {
      columns: [
          ['KTH P4 2017/2018', (KTH_ladok_courses_P4_20172018_publ/KTH_ladok_courses_P4_20172018_enr)*100]
      ],
      type: 'gauge',
  },
  gauge: {
    label: {
          value: function (value, ratio, id) {
              return value + ' (' + d3.format('%')(ratio) + ')';
     },
      show: false
  },

      units: ' %',
      width: 10, // for adjusting arc thickness
  },
  color: {
    pattern: ['#c10707', '#ff7200', '#F6C600', '#78ce5a', '#299304'],
    threshold: {
        values: [30, 50, 60, 70, 80]
    }
  },
  legend: {
    show: false
  },
  size: {
      height: 100
  },
});

var chart = c3.generate({
    bindto: '#KTH_ladok_courses_20172018',
  data: {
      columns: [
          ['KTH 2017/2018', (KTH_ladok_courses_20172018_publ/KTH_ladok_courses_20172018_enr)*100]
      ],
      type: 'gauge',
  },
  gauge: {
    label: {
          value: function (value, ratio, id) {
              return value + ' (' + d3.format('%')(ratio) + ')';
     },
      show: false
  },

      units: ' %',
      width: 10, // for adjusting arc thickness
  },
  color: {
      pattern: ['#c10707', '#ff7200', '#F6C600', '#78ce5a', '#299304'],
      threshold: {
        values: [30, 50, 60, 70, 80]
      }
  },
  legend: {
    show: false
  },
  size: {
      height: 100
  },

  // This will hide the div with the loader when this graph is drawn.

      onrendered: function() {
      document.getElementById('load').style.visibility="hidden";
      document.getElementById('content').style.visibility="visible";
  }
});

var chart = c3.generate({
    bindto: '#chart',
    data: {
      x: 'x',
      columns: [
          ['x', ...dates],
          ['Page views', ...views],
          ['User participations', ...participations ]
        ],
      axes: {
        'User participations': 'y2'
        },
      types: {
        participations: 'step',
        views: 'line'
        }
      },
      point: {
        show: false
        },
      grid: {
        y: {
          show: false
        }
      },
    color: {
        pattern: ['#000000','#b0c92b']
        },
    axis: {
        x: {
            type: 'timeseries',
            tick: {
                format: '%Y-%m-%d',
                rotate: -90,
                values: ['2016-08-29','2016-10-31','2017-01-17','2017-03-20','2017-08-28','2017-10-30', '2018-01-16','2018-03-19','2018-08-27','2018-10-19','2019-01-15','2019-03-18']
            }
          },
      y: {
          label: {
            text: 'Page Views (Black line)',
            position: 'outer-middle'
          },
        min: 0,
        padding: {
          top: 0,
          bottom: 0
        }
      },
      y2: {
        show: true,
        label: {
          text: 'User participations (Green steps)',
          position: 'outer-middle'
        },
        min: 0,
          padding: {
            top: 30,
            bottom: 0
          }
        }
      },
      zoom: {
        enabled: true,
      }
});

// Draw vertical lines to indicate start of each study period

setTimeout(function () {
chart.xgrids([{value: '2016-08-29', class: 'studyline', text:'P1-16/17'}]);
}, 0);

setTimeout(function () {
chart.xgrids.add([{value: '2016-10-31', class: 'studyline', text:'P2-16/17'}]);
}, 250);

setTimeout(function () {
chart.xgrids.add([{value: '2017-01-17', class: 'studyline', text:'P3-16/17'}]);
}, 500);

setTimeout(function () {
chart.xgrids.add([{value: '2017-03-20', class: 'studyline', text:'P4-16/17'}]);
}, 750);

setTimeout(function () {
chart.xgrids.add([{value: '2017-08-28', class: 'studyline', text:'P1-17/18'}]);
}, 1000);

setTimeout(function () {
chart.xgrids.add([{value: '2017-10-30', class: 'studyline', text:'P2-17/18'}]);
}, 1250);

setTimeout(function () {
chart.xgrids.add([{value: '2018-01-16', class: 'studyline', text:'P3-17/18'}]);
}, 1500);

setTimeout(function () {
chart.xgrids.add([{value: '2018-03-19', class: 'studyline', text:'P4-17/18'}]);
}, 1750);

setTimeout(function () {
chart.xgrids.add([{value: '2018-08-27', tclass: 'studyline', ext:'P1-18/19'}]);
}, 2000);

setTimeout(function () {
chart.xgrids.add([{value: '2018-10-19', class: 'studyline', text:'P2-18/19'}]);
}, 2250);

setTimeout(function () {
chart.xgrids.add([{value: '2019-01-15', class: 'studyline', text:'P3-18/19'}]);
}, 2500);

setTimeout(function () {
chart.xgrids.add([{value: '2019-03-18', class: 'studyline', text:'P4-18/19'}]);
}, 2750);

  }

drawGraph()

</script>

</div>

</body>

</html>
