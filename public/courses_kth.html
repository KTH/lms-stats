<!DOCTYPE html>

<html lang="en">

<head>

<meta charset="utf-8"/>

<script src="moment.js"></script>
 <link type="text/css" href="basic.css" rel="stylesheet" />
<title>Published KTH Ladok courses in Canvas LMS available to all at KTH.</title>

</head>

<body>


<h4>Academic year 2018/2019</h4>

<table id="courses">
  <thead>
    <tr>
      <th>Course name</th><th>School</th>
    </tr>
  </thead>
  <tbody id="KTH_courses_1819">
  </tbody>
</table>

<h4>Academic year 2017/2018</h4>

<table id="courses">
  <thead>
    <tr>
      <th>Course name</th><th>School</th>
    </tr>
  </thead>
  <tbody id="KTH_courses_1718">
  </tbody>
</table>

<h4>Academic year 2016/2017</h4>

<table id="courses">
  <thead>
    <tr>
      <th>Course name</th><th>School</th>
    </tr>
  </thead>
  <tbody id="KTH_courses_1617">
  </tbody>
</table>


<script>

// Const accounts

const accounts={
  14:'ABE',
  17:'CBH',
  22:'CBH',
  23:'EECS',
  24:'ITM',
  25:'EECS',
  26:'EECS',
  27:'ITM',
  28:'SCI',
  29:'CBH'
}

    async function drawGraph(){

// Fetch global course data for all courses. This data is refreshed only on app restart.

    const responseKTHCOURSES = await fetch('/api/lms-stats/kthcourses')
    const myJsonKTHCOURSES = await responseKTHCOURSES.json()

//  Filter out published courses that are published with the right access setting.

    const KTH_ladok_courses_1617 = myJsonKTHCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2016-07-01', '2017-06-30')  )
    const KTH_ladok_courses_1718 = myJsonKTHCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2017-07-01', '2018-06-30')  )
    const KTH_ladok_courses_1819 = myJsonKTHCOURSES.filter(k => k.workflow_state === 'available').filter(k => k.is_public_to_auth_users === true).filter(k => k.account_id=== 14|| k.account_id === 17|| k.account_id === 22|| k.account_id === 23|| k.account_id === 24|| k.account_id === 25|| k.account_id === 26|| k.account_id === 27|| k.account_id === 28|| k.account_id === 29).filter(k => moment(k.start_at).isBetween('2018-07-01', '2019-06-30')  )

// Courses for 2018-2019

    var orderKTH_1819 = KTH_ladok_courses_1819;

    orderKTH_1819.sort(function(a, b) {
      var nameA = a.name.toUpperCase();
      var nameB = b.name.toUpperCase();
      if (nameA < nameB) {
        return -1;
      }
      if (nameA > nameB) {
        return 1;
      }

      return 0;

    });

// Create hyperlinked list

    var text = "";
    var i;
    for (i = 0; i < orderKTH_1819.length; i++) {
        text += "<tr><td><a href=\"https://kth.instructure.com/courses/" + orderKTH_1819[i].id + "/\" target=\"_blank\">" + orderKTH_1819[i].name + "</a></td><td>" + accounts[''+ orderKTH_1819[i].account_id] + "</td></tr>";
    }

    document.getElementById("KTH_courses_1819").innerHTML = text;

// 2017-2018

    var orderKTH_1718 = KTH_ladok_courses_1718;

    orderKTH_1718.sort(function(a, b) {
      var nameA = a.name.toUpperCase();
      var nameB = b.name.toUpperCase();
      if (nameA < nameB) {
        return -1;
      }
      if (nameA > nameB) {
        return 1;
      }

      return 0;

    });

// Create hyperlinked list

    var text = "";
    var i;
    for (i = 0; i < orderKTH_1718.length; i++) {
        text += "<tr><td><a href=\"https://kth.instructure.com/courses/" + orderKTH_1718[i].id + "/\" target=\"_blank\">" + orderKTH_1718[i].name + "</a></td><td>" + accounts[''+ orderKTH_1718[i].account_id] + "</td></tr>";
    }

    document.getElementById("KTH_courses_1718").innerHTML = text;

// 2016-2017

var orderKTH_1617 = KTH_ladok_courses_1617;

    orderKTH_1617.sort(function(a, b) {
      var nameA = a.name.toUpperCase();
      var nameB = b.name.toUpperCase();
      if (nameA < nameB) {
        return -1;
      }
      if (nameA > nameB) {
        return 1;
      }

      return 0;

});

// Create hyperlinked list of KTH Courses

    var text = "";
    var i;
    for (i = 0; i < orderKTH_1617.length; i++) {
        text += "<tr><td><a href=\"https://kth.instructure.com/courses/" + orderKTH_1617[i].id + "/\" target=\"_blank\">" + orderKTH_1617[i].name + "</a></td><td>" + accounts[''+ orderKTH_1617[i].account_id] + "</td></tr>";
    }

    document.getElementById("KTH_courses_1617").innerHTML = text;

      }

drawGraph()

</script>


</body>

</html>
